#ifndef WEB_CONTENT_H
#define WEB_CONTENT_H

#include <pgmspace.h>

const char INDEX_HTML[] PROGMEM = "<!DOCTYPE html>\n<html lang=\"ro\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no\">\n    <title>Productivity Bloom</title>\n    <style>:root{--primary:#2ecc71;--primary-dark:#27ae60;--primary-light:#a8e6cf;--secondary:#3498db;--secondary-dark:#2980b9;--danger:#e74c3c;--danger-dark:#c0392b;--warning:#f39c12;--warning-dark:#d68910;--bg-dark:#1a1a2e;--bg-card:#16213e;--bg-input:#0f3460;--text-primary:#ffffff;--text-secondary:#b8c5d6;--text-muted:#6c7a89;--border-color:#2d4a6f;--shadow:0 4px 15px rgba(0,0,0,0.3);--spacing-xs:0.25rem;--spacing-sm:0.5rem;--spacing-md:1rem;--spacing-lg:1.5rem;--spacing-xl:2rem;--radius-sm:8px;--radius-md:12px;--radius-lg:16px;--radius-full:50%;--transition:all 0.3s ease;}*{margin:0;padding:0;box-sizing:border-box;}html{font-size:16px;}body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen,Ubuntu,sans-serif;background:var(--bg-dark);color:var(--text-primary);min-height:100vh;line-height:1.5;-webkit-font-smoothing:antialiased;}.app-container{max-width:480px;margin:0 auto;padding:var(--spacing-md);padding-bottom:calc(var(--spacing-xl) + 60px);}.header{display:flex;justify-content:space-between;align-items:center;padding:var(--spacing-md) 0;margin-bottom:var(--spacing-md);}.logo{display:flex;align-items:center;gap:var(--spacing-sm);}.logo-icon{font-size:1.2rem;font-weight:700;color:var(--primary);background:var(--bg-input);padding:0.3rem 0.5rem;border-radius:var(--radius-sm);}@keyframes pulse{0%,100%{transform:scale(1);}50%{transform:scale(1.05);}}.logo h1{font-size:1.2rem;font-weight:600;background:linear-gradient(135deg,var(--primary),var(--secondary));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}.connection-status{display:flex;align-items:center;gap:var(--spacing-xs);font-size:0.75rem;color:var(--text-muted);}.status-dot{width:8px;height:8px;border-radius:var(--radius-full);background:var(--warning);animation:blink 1s infinite;}.status-dot.connected{background:var(--primary);animation:none;}.status-dot.disconnected{background:var(--danger);}@keyframes blink{0%,100%{opacity:1;}50%{opacity:0.3;}}.card{background:var(--bg-card);border-radius:var(--radius-lg);padding:var(--spacing-lg);margin-bottom:var(--spacing-md);box-shadow:var(--shadow);border:1px solid var(--border-color);}.card h2{font-size:1rem;font-weight:600;margin-bottom:var(--spacing-md);color:var(--text-primary);}.status-card{background:linear-gradient(135deg,var(--bg-card) 0%,rgba(46,204,113,0.1) 100%);}.status-display{display:flex;align-items:center;justify-content:center;gap:var(--spacing-md);margin-bottom:var(--spacing-md);}.status-info{display:flex;flex-direction:column;}.status-info.centered{align-items:center;text-align:center;}.status-label{font-size:0.75rem;font-weight:700;letter-spacing:1px;color:var(--primary);text-transform:uppercase;}.status-label.focusing{color:var(--danger);}.status-label.break{color:var(--secondary);}.status-label.withered{color:var(--warning);}.current-task{font-size:1.1rem;font-weight:500;color:var(--text-secondary);}.timer-display{text-align:center;}.timer-value{font-size:3rem;font-weight:700;font-family:'Courier New',monospace;letter-spacing:2px;}.timer-progress{height:6px;background:var(--bg-input);border-radius:var(--radius-sm);margin-top:var(--spacing-sm);overflow:hidden;}.timer-bar{height:100%;background:linear-gradient(90deg,var(--primary),var(--secondary));border-radius:var(--radius-sm);width:0%;transition:width 1s linear;}.plant-card{text-align:center;}.plant-display{display:flex;flex-direction:column;align-items:center;margin-bottom:var(--spacing-lg);}.plant-visual{position:relative;margin-bottom:var(--spacing-md);}.plant-stage{font-size:4rem;animation:sway 3s ease-in-out infinite;transition:var(--transition);}.plant-stage.withered{filter:grayscale(100%);animation:shake 0.5s ease-in-out;}.plant-pot{font-size:2rem;margin-top:-10px;}@keyframes sway{0%,100%{transform:rotate(-3deg);}50%{transform:rotate(3deg);}}@keyframes shake{0%,100%{transform:translateX(0);}25%{transform:translateX(-5px);}75%{transform:translateX(5px);}}.plant-pot{font-size:2rem;margin-top:-10px;}.plant-info{display:flex;flex-direction:column;gap:var(--spacing-xs);}.plant-stage-text{color:var(--text-secondary);font-size:0.9rem;}.stage-number{color:var(--primary);font-weight:600;}.plant-health{display:flex;align-items:center;justify-content:center;gap:var(--spacing-xs);font-size:0.85rem;}.plant-health.withered .health-icon{content:'ðŸ’”';}.plant-health.withered .health-text{color:var(--danger);}.water-hint{margin-top:var(--spacing-sm);font-size:0.75rem;color:var(--text-muted);font-style:italic;transition:var(--transition);}.water-hint.ready{color:var(--secondary);font-style:normal;font-weight:500;}.water-hint.complete{color:var(--primary);}.plant-actions{display:flex;gap:var(--spacing-md);}.btn{display:flex;align-items:center;justify-content:center;gap:var(--spacing-sm);padding:var(--spacing-sm) var(--spacing-lg);border:none;border-radius:var(--radius-md);font-size:0.9rem;font-weight:600;cursor:pointer;transition:var(--transition);flex:1;}.btn:active{transform:scale(0.96);}.btn:disabled{opacity:0.4;cursor:not-allowed;transform:none;background:var(--bg-input) !important;color:var(--text-muted) !important;box-shadow:none !important;pointer-events:none;}.btn-icon{font-size:1.1rem;}.btn-primary{background:linear-gradient(135deg,var(--primary),var(--primary-dark));color:white;}.btn-primary:hover:not(:disabled){box-shadow:0 4px 15px rgba(46,204,113,0.4);}.btn-secondary{background:var(--bg-input);color:var(--text-secondary);border:1px solid var(--border-color);}.btn-water{background:linear-gradient(135deg,var(--secondary),var(--secondary-dark));color:white;}.btn-water:hover:not(:disabled){box-shadow:0 4px 15px rgba(52,152,219,0.4);}.btn-danger{background:linear-gradient(135deg,var(--danger),var(--danger-dark));color:white;}.btn-danger:hover:not(:disabled){box-shadow:0 4px 15px rgba(231,76,60,0.4);}.btn-success{background:linear-gradient(135deg,var(--primary),var(--primary-dark));color:white;}.btn-full{width:100%;}.btn-sm{padding:var(--spacing-xs) var(--spacing-sm);font-size:0.8rem;}.goal-section{background:var(--bg-input);padding:var(--spacing-md);border-radius:var(--radius-md);margin-bottom:var(--spacing-md);border:2px dashed var(--border-color);transition:var(--transition);}.goal-section.locked{border-style:solid;border-color:var(--primary);background:rgba(46,204,113,0.1);}.goal-setter{display:flex;flex-direction:column;gap:var(--spacing-sm);}.goal-section.locked .goal-setter{display:none;}.goal-setter label{font-size:0.9rem;font-weight:500;color:var(--text-secondary);}.goal-input-row{display:flex;gap:var(--spacing-sm);}.goal-input-row input{flex:1;padding:var(--spacing-sm) var(--spacing-md);background:var(--bg-card);border:1px solid var(--border-color);border-radius:var(--radius-sm);color:var(--text-primary);font-size:1rem;text-align:center;}.goal-input-row input:focus{outline:none;border-color:var(--primary);}.goal-display{margin-top:var(--spacing-sm);}.goal-info{display:flex;justify-content:space-between;align-items:center;}.goal-target{font-weight:600;color:var(--primary);}.task-form{background:var(--bg-input);padding:var(--spacing-md);border-radius:var(--radius-md);margin-bottom:var(--spacing-lg);}.form-group{margin-bottom:var(--spacing-md);}.form-group:last-of-type{margin-bottom:var(--spacing-md);}.form-group label{display:block;font-size:0.8rem;color:var(--text-muted);margin-bottom:var(--spacing-xs);}.form-group input{width:100%;padding:var(--spacing-sm) var(--spacing-md);background:var(--bg-card);border:1px solid var(--border-color);border-radius:var(--radius-sm);color:var(--text-primary);font-size:1rem;transition:var(--transition);}.form-group input:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 3px rgba(46,204,113,0.2);}.form-group input::placeholder{color:var(--text-muted);}.form-row{display:flex;gap:var(--spacing-md);}.form-row .form-group{flex:1;}.task-list-header{display:flex;justify-content:space-between;align-items:center;padding-bottom:var(--spacing-sm);border-bottom:1px solid var(--border-color);margin-bottom:var(--spacing-md);font-size:0.85rem;color:var(--text-muted);}.task-count{color:var(--primary);font-weight:600;}.task-items{max-height:300px;overflow-y:auto;}.empty-state{display:flex;flex-direction:column;align-items:center;padding:var(--spacing-xl);color:var(--text-muted);}.empty-icon{font-size:2rem;margin-bottom:var(--spacing-sm);opacity:0.5;}.task-item{display:flex;align-items:center;gap:var(--spacing-sm);padding:var(--spacing-md);background:var(--bg-input);border-radius:var(--radius-md);margin-bottom:var(--spacing-sm);transition:var(--transition);animation:slideIn 0.3s ease;}@keyframes slideIn{from{opacity:0;transform:translateY(-10px);}to{opacity:1;transform:translateY(0);}}.task-item.completed{opacity:0.6;background:rgba(46,204,113,0.1);}.task-item.active{border:2px solid var(--primary);background:rgba(46,204,113,0.1);}.task-item.selected{border:2px solid var(--warning);background:rgba(243,156,18,0.15);animation:pulse-border 2s infinite;}@keyframes pulse-border{0%,100%{border-color:var(--warning);}50%{border-color:var(--warning-dark);box-shadow:0 0 10px rgba(243,156,18,0.5);}}.task-hint{font-size:0.75rem;color:var(--warning);margin-top:4px;animation:blink 1.5s infinite;}.task-hint.active{color:var(--primary);}@keyframes blink{0%,100%{opacity:1;}50%{opacity:0.5;}}.task-checkbox{width:22px;height:22px;border:2px solid var(--border-color);border-radius:var(--radius-sm);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:var(--transition);flex-shrink:0;}.task-checkbox.disabled{opacity:0.4;cursor:not-allowed;pointer-events:none;background:var(--bg-input);}.task-checkbox.checked{background:var(--primary);border-color:var(--primary);}.task-checkbox.checked::after{content:'âœ“';color:white;font-size:0.8rem;}.task-info{flex:1;min-width:0;}.task-name{font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}.task-duration{font-size:0.75rem;color:var(--text-muted);}.task-actions{display:flex;gap:var(--spacing-xs);}.task-btn{width:32px;height:32px;border:none;border-radius:var(--radius-sm);background:var(--bg-card);color:var(--text-primary);font-size:1rem;font-weight:bold;cursor:pointer;transition:var(--transition);display:flex;align-items:center;justify-content:center;}.task-btn:hover{background:var(--primary);color:white;}.task-btn.delete:hover{background:var(--danger);color:white;}.task-btn.select{background:rgba(243,156,18,0.2);border-color:var(--warning);}.task-btn.select:hover{background:var(--warning);color:white;}.task-btn.cancel{background:rgba(231,76,60,0.2);border-color:var(--danger);}.task-btn.cancel:hover{background:var(--danger);color:white;}.stats-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:var(--spacing-md);margin-bottom:var(--spacing-lg);}.stat-item{text-align:center;padding:var(--spacing-md);background:var(--bg-input);border-radius:var(--radius-md);}.stat-value{display:block;font-size:1.8rem;font-weight:700;color:var(--primary);}.stat-label{font-size:0.7rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.5px;}.progress-section{margin-bottom:var(--spacing-md);}.progress-header{display:flex;justify-content:space-between;font-size:0.85rem;margin-bottom:var(--spacing-xs);}.progress-bar{height:12px;background:var(--bg-input);border-radius:var(--radius-sm);overflow:hidden;}.progress-fill{height:100%;background:linear-gradient(90deg,var(--primary),var(--secondary));border-radius:var(--radius-sm);width:0%;transition:width 0.5s ease;}.time-info{display:flex;align-items:center;justify-content:center;gap:var(--spacing-sm);padding-top:var(--spacing-md);border-top:1px solid var(--border-color);font-size:0.85rem;color:var(--text-muted);}.clock-icon{font-size:1.2rem;}#currentTime{font-weight:600;color:var(--text-primary);}.footer{position:fixed;bottom:0;left:0;right:0;background:var(--bg-card);padding:var(--spacing-md);display:flex;justify-content:space-between;font-size:0.75rem;color:var(--text-muted);border-top:1px solid var(--border-color);}.toast{position:fixed;bottom:80px;left:50%;transform:translateX(-50%) translateY(100px);background:var(--bg-card);padding:var(--spacing-sm) var(--spacing-lg);border-radius:var(--radius-md);display:flex;align-items:center;gap:var(--spacing-sm);box-shadow:0 4px 20px rgba(0,0,0,0.4);z-index:1000;opacity:0;transition:all 0.3s ease;border:1px solid var(--border-color);}.toast.show{transform:translateX(-50%) translateY(0);opacity:1;}.toast.success{border-color:var(--primary);}.toast.error{border-color:var(--danger);}.modal-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.7);display:flex;align-items:center;justify-content:center;z-index:1001;opacity:0;visibility:hidden;transition:var(--transition);}.modal-overlay.show{opacity:1;visibility:visible;}.modal{background:var(--bg-card);padding:var(--spacing-xl);border-radius:var(--radius-lg);text-align:center;max-width:320px;width:90%;transform:scale(0.9);transition:var(--transition);}.modal-overlay.show .modal{transform:scale(1);}.modal-icon{font-size:3rem;margin-bottom:var(--spacing-md);}.modal h3{margin-bottom:var(--spacing-sm);}.modal p{color:var(--text-secondary);margin-bottom:var(--spacing-lg);}.modal-actions{display:flex;gap:var(--spacing-md);}::-webkit-scrollbar{width:6px;}::-webkit-scrollbar-track{background:var(--bg-input);border-radius:3px;}::-webkit-scrollbar-thumb{background:var(--border-color);border-radius:3px;}::-webkit-scrollbar-thumb:hover{background:var(--primary);}@media (min-width:768px){.app-container{padding:var(--spacing-xl);}.logo h1{font-size:1.4rem;}.timer-value{font-size:4rem;}.plant-stage{font-size:5rem;}}@media (prefers-color-scheme:light){}@media (prefers-reduced-motion:reduce){*{animation:none !important;transition:none !important;}}.weekly-card{background:linear-gradient(135deg,var(--bg-card) 0%,rgba(52,152,219,0.1) 100%);}.weekly-summary{display:grid;grid-template-columns:repeat(3,1fr);gap:var(--spacing-md);margin-bottom:var(--spacing-md);}.weekly-chart{display:flex;align-items:flex-end;justify-content:space-between;height:80px;padding:var(--spacing-sm);background:var(--bg-input);border-radius:var(--radius-md);margin-bottom:var(--spacing-sm);}.chart-bar{flex:1;margin:0 2px;background:linear-gradient(to top,var(--primary),var(--secondary));border-radius:var(--radius-sm) var(--radius-sm) 0 0;min-height:4px;transition:height 0.3s ease;position:relative;}.chart-bar::after{content:attr(data-day);position:absolute;bottom:-18px;left:50%;transform:translateX(-50%);font-size:0.6rem;color:var(--text-muted);}.chart-bar.today{background:linear-gradient(to top,var(--warning),var(--warning-dark));}.weekly-best{text-align:center;color:var(--text-muted);padding-top:var(--spacing-sm);border-top:1px solid var(--border-color);}.weekly-best span{color:var(--primary);font-weight:600;}.stats-actions{display:flex;justify-content:center;margin-top:var(--spacing-md);padding-top:var(--spacing-md);border-top:1px solid var(--border-color);}.time-info{display:flex;align-items:center;justify-content:center;gap:var(--spacing-sm);padding-top:var(--spacing-md);border-top:1px solid var(--border-color);font-size:0.85rem;color:var(--text-muted);}.time-info .btn-sm{padding:0.2rem 0.5rem;font-size:0.7rem;}</style>\n</head>\n<body>\n    <div class=\"app-container\">\n        <!-- Header -->\n        <header class=\"header\">\n            <div class=\"logo\">\n                <span class=\"logo-icon\">PB</span>\n                <h1>Productivity Bloom</h1>\n            </div>\n            <div class=\"connection-status\" id=\"connectionStatus\">\n                <span class=\"status-dot\"></span>\n                <span class=\"status-text\">Conectare...</span>\n            </div>\n        </header>\n\n        <!-- Status Card -->\n        <section class=\"card status-card\">\n            <div class=\"status-display\">\n                <div class=\"status-info centered\">\n                    <span class=\"status-label\" id=\"statusLabel\">IDLE</span>\n                    <span class=\"current-task\" id=\"currentTask\">Niciun task activ</span>\n                </div>\n            </div>\n            <div class=\"timer-display\" id=\"timerDisplay\">\n                <span class=\"timer-value\" id=\"timerValue\">00:00</span>\n                <div class=\"timer-progress\">\n                    <div class=\"timer-bar\" id=\"timerBar\"></div>\n                </div>\n            </div>\n        </section>\n\n        <!-- Plant Section -->\n        <section class=\"card plant-card\">\n            <h2>Planta Ta</h2>\n            <div class=\"plant-display\">\n                <div class=\"plant-visual\" id=\"plantVisual\">\n                    <div class=\"plant-stage\" id=\"plantStage\"></div>\n                    <div class=\"plant-pot\"></div>\n                </div>\n                <div class=\"plant-info\">\n                    <div class=\"plant-stage-text\">\n                        Stadiu: <span id=\"plantStageText\">Samanta</span>\n                        <span class=\"stage-number\" id=\"stageNumber\">(0/0)</span>\n                    </div>\n                    <div class=\"plant-health\" id=\"plantHealth\">\n                        <span class=\"health-icon\"></span>\n                        <span class=\"health-text\">Sanatoasa</span>\n                    </div>\n                    <div class=\"water-hint\" id=\"waterHint\">\n                        <small>Completeaza un task pentru a putea uda planta</small>\n                    </div>\n                </div>\n            </div>\n            <div class=\"plant-actions\">\n                <button class=\"btn btn-water\" id=\"btnWater\" disabled>\n                    <span class=\"btn-icon\"></span>\n                    <span class=\"btn-text\">Uda Planta</span>\n                </button>\n                <button class=\"btn btn-danger\" id=\"btnKill\">\n                    <span class=\"btn-icon\"></span>\n                    <span class=\"btn-text\">Demo Kill</span>\n                </button>\n            </div>\n        </section>\n\n        <!-- Task Manager -->\n        <section class=\"card task-card\">\n            <h2>Task Manager</h2>\n            \n            <!-- Daily Goal Section -->\n            <div class=\"goal-section\" id=\"goalSection\">\n                <div class=\"goal-setter\">\n                    <label for=\"dailyGoalInput\">Obiectiv zilnic:</label>\n                    <div class=\"goal-input-row\">\n                        <input type=\"number\" id=\"dailyGoalInput\" value=\"3\" min=\"1\" max=\"20\" placeholder=\"Nr. task-uri\">\n                        <button class=\"btn btn-success btn-sm\" id=\"btnSetGoal\">Seteaza</button>\n                    </div>\n                </div>\n                <div class=\"goal-display\" id=\"goalDisplay\"></div>\n            </div>\n            \n            <!-- Add Task Form -->\n            <div class=\"task-form\">\n                <div class=\"form-group\">\n                    <label for=\"taskName\">Nume Task</label>\n                    <input type=\"text\" id=\"taskName\" placeholder=\"ex: Invata pentru examen\" maxlength=\"30\">\n                </div>\n                <div class=\"form-row\">\n                    <div class=\"form-group\">\n                        <label for=\"focusTime\">Focus (min)</label>\n                        <input type=\"number\" id=\"focusTime\" value=\"25\" min=\"1\" max=\"120\">\n                    </div>\n                    <div class=\"form-group\">\n                        <label for=\"breakTime\">Pauza (min)</label>\n                        <input type=\"number\" id=\"breakTime\" value=\"5\" min=\"1\" max=\"30\">\n                    </div>\n                </div>\n                <button class=\"btn btn-primary btn-full\" id=\"btnAddTask\">\n                    <span class=\"btn-icon\">+</span>\n                    <span class=\"btn-text\">Adauga Task</span>\n                </button>\n            </div>\n\n            <!-- Task List -->\n            <div class=\"task-list\" id=\"taskList\">\n                <div class=\"task-list-header\">\n                    <span>Task-uri pentru azi</span>\n                    <span class=\"task-count\" id=\"taskCount\">0 task-uri</span>\n                </div>\n                <div class=\"task-items\" id=\"taskItems\">\n                    <div class=\"empty-state\" id=\"emptyState\">\n                        <span class=\"empty-icon\">--</span>\n                        <span class=\"empty-text\">Niciun task adaugat</span>\n                    </div>\n                </div>\n            </div>\n        </section>\n\n        <!-- Statistics -->\n        <section class=\"card stats-card\">\n            <h2>Statistici Azi</h2>\n            <div class=\"stats-grid\">\n                <div class=\"stat-item\">\n                    <span class=\"stat-value\" id=\"tasksCompleted\">0</span>\n                    <span class=\"stat-label\">Completate</span>\n                </div>\n                <div class=\"stat-item\">\n                    <span class=\"stat-value\" id=\"tasksTotal\">0</span>\n                    <span class=\"stat-label\">Total</span>\n                </div>\n                <div class=\"stat-item\">\n                    <span class=\"stat-value\" id=\"focusTotal\">0</span>\n                    <span class=\"stat-label\">Min Focus</span>\n                </div>\n            </div>\n            <div class=\"progress-section\">\n                <div class=\"progress-header\">\n                    <span>Progres zilnic</span>\n                    <span id=\"progressPercent\">0%</span>\n                </div>\n                <div class=\"progress-bar\">\n                    <div class=\"progress-fill\" id=\"progressFill\"></div>\n                </div>\n            </div>\n            <div class=\"time-info\">\n                <span class=\"clock-icon\">Ora:</span>\n                <span id=\"currentTime\">--:--</span>\n                <button class=\"btn btn-sm btn-secondary\" id=\"btnSyncTime\" title=\"Sincronizeaza ora de pe telefon\">Sync</button>\n            </div>\n            <div class=\"stats-actions\">\n                <button class=\"btn btn-danger btn-sm\" id=\"btnResetDay\">Reset Ziua</button>\n            </div>\n        </section>\n\n        <!-- Weekly Statistics -->\n        <section class=\"card weekly-card\">\n            <h2>Statistici Saptamanale</h2>\n            <div class=\"weekly-stats\" id=\"weeklyStats\">\n                <div class=\"weekly-summary\">\n                    <div class=\"stat-item\">\n                        <span class=\"stat-value\" id=\"weeklyTasks\">0</span>\n                        <span class=\"stat-label\">Task-uri</span>\n                    </div>\n                    <div class=\"stat-item\">\n                        <span class=\"stat-value\" id=\"weeklyFocus\">0</span>\n                        <span class=\"stat-label\">Min Focus</span>\n                    </div>\n                    <div class=\"stat-item\">\n                        <span class=\"stat-value\" id=\"weeklyAvg\">0</span>\n                        <span class=\"stat-label\">Media/zi</span>\n                    </div>\n                </div>\n                <div class=\"weekly-chart\" id=\"weeklyChart\"></div>\n                <div class=\"weekly-best\" id=\"weeklyBest\">\n                    <small>Cea mai productiva zi: <span id=\"bestDay\">-</span></small>\n                </div>\n            </div>\n        </section>\n\n        <!-- Footer -->\n        <footer class=\"footer\">\n            <span>Productivity Bloom v1.0</span>\n            <span id=\"espIP\">ESP32</span>\n        </footer>\n    </div>\n\n    <!-- Toast Notification -->\n    <div class=\"toast\" id=\"toast\">\n        <span class=\"toast-icon\" id=\"toastIcon\"></span>\n        <span class=\"toast-message\" id=\"toastMessage\">Mesaj</span>\n    </div>\n\n    <!-- Confirmation Modal -->\n    <div class=\"modal-overlay\" id=\"modalOverlay\">\n        <div class=\"modal\">\n            <div class=\"modal-icon\" id=\"modalIcon\">!</div>\n            <h3 id=\"modalTitle\">Confirmare</h3>\n            <p id=\"modalMessage\">Esti sigur?</p>\n            <div class=\"modal-actions\">\n                <button class=\"btn btn-secondary\" id=\"modalCancel\">Anuleaza</button>\n                <button class=\"btn btn-danger\" id=\"modalConfirm\">Confirma</button>\n            </div>\n        </div>\n    </div>\n\n    <script>/**\n* Productivity Bloom - Web Interface\n* Comunicare cu ESP32 prin API REST È™i WebSocket\n*/\n// ============================================\n// Configuration & State\n// ============================================\n// Use current page hostname (works for both AP mode and WiFi mode)\nconst ESP32_IP = window.location.hostname || '192.168.4.1';\nconst CONFIG = {\nAPI_BASE: `http://${ESP32_IP}`,\nWS_URL: `ws://${ESP32_IP}:81`,\nRECONNECT_INTERVAL: 2000,\nUPDATE_INTERVAL: 1000\n};\n// Debug log\nconsole.log('Productivity Bloom loading, ESP32 IP:', ESP32_IP);\n// Application State\nconst state = {\nconnected: false,\nwsConnected: false,  // Track WebSocket specifically\nstatus: 'idle', // idle, focusing, break, withered\ncurrentTask: null,\ntimeLeft: 0,\ntotalTime: 0,\nplant: {\nstage: 0,\nisWithered: false\n},\ntasks: [],\nstats: {\ncompleted: 0,\ntotal: 0,\nfocusMinutes: 0\n},\nws: null,\npendingWater: 0,  // CÃ¢te \"udÄƒri\" sunt disponibile (task-uri completate neapoi udate)\nwateredCount: 0,  // CÃ¢te task-uri au fost \"confirmate\" prin udare (pentru afiÈ™are)\ndailyGoal: 0,     // Obiectivul zilnic setat de utilizator\ncurrentSessionGoal: 0, // CÃ¢te task-uri noi trebuie fÄƒcute Ã®n sesiunea curentÄƒ\ngoalLocked: false, // DacÄƒ obiectivul a fost confirmat\nselectedTaskId: 0,  // Task pregÄƒtit pentru pornire cu flip MPU\nshowingConfirmModal: false,  // Modal de confirmare flip\nflipCancelledWaitingFlipBack: false  // Waiting for user to flip back after cancel\n};\n// Plant stages configuration\nconst PLANT_STAGES = [\n{ emoji: 'ðŸŒ°', name: 'Samanta' },\n{ emoji: 'ðŸŒ±', name: 'Lastar' },\n{ emoji: 'ðŸŒ¿', name: 'Crestere' },\n{ emoji: 'ðŸŒ¸', name: 'Inflorit' }\n];\n// ============================================\n// DOM Elements\n// ============================================\nconst elements = {\n// Connection\nconnectionStatus: document.getElementById('connectionStatus'),\n// Status\nstatusLabel: document.getElementById('statusLabel'),\ncurrentTask: document.getElementById('currentTask'),\ntimerValue: document.getElementById('timerValue'),\ntimerBar: document.getElementById('timerBar'),\n// Plant\nplantStage: document.getElementById('plantStage'),\nplantStageText: document.getElementById('plantStageText'),\nstageNumber: document.getElementById('stageNumber'),\nplantHealth: document.getElementById('plantHealth'),\nplantVisual: document.getElementById('plantVisual'),\nwaterHint: document.getElementById('waterHint'),\nbtnWater: document.getElementById('btnWater'),\nbtnKill: document.getElementById('btnKill'),\n// Task Form\ntaskName: document.getElementById('taskName'),\nfocusTime: document.getElementById('focusTime'),\nbreakTime: document.getElementById('breakTime'),\nbtnAddTask: document.getElementById('btnAddTask'),\n// Daily Goal\ndailyGoalInput: document.getElementById('dailyGoalInput'),\nbtnSetGoal: document.getElementById('btnSetGoal'),\nbtnResetGoal: document.getElementById('btnResetGoal'),\ngoalDisplay: document.getElementById('goalDisplay'),\ngoalSection: document.getElementById('goalSection'),\n// Task List\ntaskItems: document.getElementById('taskItems'),\ntaskCount: document.getElementById('taskCount'),\nemptyState: document.getElementById('emptyState'),\n// Stats\ntasksCompleted: document.getElementById('tasksCompleted'),\ntasksTotal: document.getElementById('tasksTotal'),\nfocusTotal: document.getElementById('focusTotal'),\nprogressPercent: document.getElementById('progressPercent'),\nprogressFill: document.getElementById('progressFill'),\ncurrentTime: document.getElementById('currentTime'),\nbtnSyncTime: document.getElementById('btnSyncTime'),\nbtnResetDay: document.getElementById('btnResetDay'),\n// Weekly Stats\nweeklyTasks: document.getElementById('weeklyTasks'),\nweeklyFocus: document.getElementById('weeklyFocus'),\nweeklyAvg: document.getElementById('weeklyAvg'),\nweeklyChart: document.getElementById('weeklyChart'),\nbestDay: document.getElementById('bestDay'),\n// Footer\nespIP: document.getElementById('espIP'),\n// Toast\ntoast: document.getElementById('toast'),\ntoastIcon: document.getElementById('toastIcon'),\ntoastMessage: document.getElementById('toastMessage'),\n// Modal\nmodalOverlay: document.getElementById('modalOverlay'),\nmodalIcon: document.getElementById('modalIcon'),\nmodalTitle: document.getElementById('modalTitle'),\nmodalMessage: document.getElementById('modalMessage'),\nmodalCancel: document.getElementById('modalCancel'),\nmodalConfirm: document.getElementById('modalConfirm')\n};\n// ============================================\n// WebSocket Connection\n// ============================================\n// Helper to check if we're in development mode (only localhost)\nfunction isDevMode() {\nconst hostname = window.location.hostname;\n// Only treat as dev mode if literally on localhost\nreturn hostname === '127.0.0.1' || hostname === 'localhost';\n}\nfunction connectWebSocket() {\nconsole.log('connectWebSocket called, isDevMode:', isDevMode());\n// Pentru dezvoltare fÄƒrÄƒ ESP32, folosim mock\nif (isDevMode()) {\nconsole.log('Development mode - using mock data');\nsetConnectionStatus(true);\nloadMockData();\nreturn;\n}\n// Close existing connection if any\nif (state.ws) {\ntry {\nstate.ws.close();\n} catch (e) {}\nstate.ws = null;\n}\ntry {\nconsole.log('Attempting WebSocket connection to:', CONFIG.WS_URL);\nstate.ws = new WebSocket(CONFIG.WS_URL);\nstate.ws.onopen = () => {\nconsole.log('WebSocket connected successfully');\nstate.wsConnected = true;\nsetConnectionStatus(true);\nshowToast('Conectat la ESP32!', 'success');\n// Refresh stats on reconnect\nfetchWeeklyStats();\n};\nstate.ws.onmessage = (event) => {\ntry {\nconst data = JSON.parse(event.data);\nhandleWebSocketMessage(data);\n} catch (e) {\nconsole.error('Failed to parse WS message:', e);\n}\n};\nstate.ws.onclose = () => {\nconsole.log('WebSocket disconnected');\nstate.wsConnected = false;\nsetConnectionStatus(false);\n// Reconnect after delay\nsetTimeout(connectWebSocket, CONFIG.RECONNECT_INTERVAL);\n};\nstate.ws.onerror = (error) => {\nconsole.error('WebSocket error:', error, 'URL:', CONFIG.WS_URL);\nsetConnectionStatus(false);\n};\n} catch (e) {\nconsole.error('WebSocket connection failed:', e);\nsetConnectionStatus(false);\nsetTimeout(connectWebSocket, CONFIG.RECONNECT_INTERVAL);\n}\n}\nfunction handleWebSocketMessage(data) {\nswitch (data.type) {\ncase 'status':\nupdateStatus(data);\nbreak;\ncase 'plant':\nupdatePlant(data);\nbreak;\ncase 'tasks':\nstate.tasks = data.tasks || [];\nrenderTasks();\nbreak;\ncase 'stats':\nupdateStats(data);\nbreak;\ncase 'flip':\nshowToast('Cub Ã®ntors! ' + (data.paused ? 'PauzÄƒ' : 'Continui'), 'success');\nbreak;\ncase 'revive':\nshowReviveAnimation();\nshowToast(data.message || 'Planta a reinviat!', 'success');\nbreak;\n}\n}\nfunction sendWebSocketMessage(data) {\nif (state.ws && state.ws.readyState === WebSocket.OPEN) {\nstate.ws.send(JSON.stringify(data));\n} else {\n// Fallback to REST API\nsendAPIRequest(data);\n}\n}\n// ============================================\n// API Communication\n// ============================================\nasync function sendAPIRequest(action) {\n// Pentru dezvoltare, simulÄƒm rÄƒspunsuri\nif (isDevMode()) {\nreturn handleMockAction(action);\n}\ntry {\nconst response = await fetch(`${CONFIG.API_BASE}/api/action`, {\nmethod: 'POST',\nheaders: { 'Content-Type': 'application/json' },\nbody: JSON.stringify(action)\n});\nreturn await response.json();\n} catch (e) {\nconsole.error('API request failed:', e);\nshowToast('Eroare de conexiune', 'error');\nreturn null;\n}\n}\nasync function fetchTasks() {\nif (isDevMode()) {\nreturn; // Mock data already loaded\n}\ntry {\nconst response = await fetch(`${CONFIG.API_BASE}/api/tasks`);\nconst data = await response.json();\nstate.tasks = data.tasks || [];\nrenderTasks();\n} catch (e) {\nconsole.error('Failed to fetch tasks:', e);\n}\n}\nasync function fetchStatus() {\nconsole.log('fetchStatus called, isDevMode:', isDevMode());\nif (isDevMode()) {\nreturn;\n}\nconst url = `${CONFIG.API_BASE}/api/status`;\nconsole.log('Fetching status from:', url);\ntry {\nconst response = await fetch(url);\nconsole.log('fetchStatus response:', response.status);\nconst data = await response.json();\nconsole.log('fetchStatus data:', data);\nupdateStatus(data);\nupdatePlant(data.plant);\nupdateStats(data.stats);\n// If we got here, we have connectivity (even if WebSocket failed)\nif (!state.connected) {\nsetConnectionStatus(true);\nconsole.log('Connected via API polling (WebSocket unavailable)');\n}\n} catch (e) {\nconsole.error('Failed to fetch status:', e);\nsetConnectionStatus(false);\n}\n}\n// ============================================\n// UI Update Functions\n// ============================================\nfunction setConnectionStatus(connected) {\nstate.connected = connected;\nconst statusDot = elements.connectionStatus.querySelector('.status-dot');\nconst statusText = elements.connectionStatus.querySelector('.status-text');\nstatusDot.className = 'status-dot ' + (connected ? 'connected' : 'disconnected');\nstatusText.textContent = connected ? 'Conectat' : 'Deconectat';\n}\nfunction updateStatus(data) {\nconst prevStatus = state.status;\nconst prevTask = state.currentTask;\nstate.status = data.state || 'idle';\nstate.timeLeft = data.timeLeft || 0;\nstate.totalTime = data.totalTime || 0;\nstate.currentTask = data.taskName || null;\n// Check if ESP32 is waiting for flip confirmation\n// But NOT if we're already showing the \"flip back\" message\nif (data.waitingForConfirmation && !state.showingConfirmModal && !state.flipCancelledWaitingFlipBack) {\nshowFlipConfirmModal();\n}\n// If no longer waiting and we were waiting for flip back, hide modal and resume\nif (!data.waitingForConfirmation && state.flipCancelledWaitingFlipBack) {\nhideModal();\nstate.flipCancelledWaitingFlipBack = false;\nshowToast('Timer resumed!', 'success');\n}\n// Update status display\nconst statusConfig = {\nidle: { icon: '||', label: 'IDLE', class: '' },\nfocusing: { icon: '>>', label: 'FOCUSING', class: 'focusing' },\npaused: { icon: '||', label: 'PAUSED', class: 'paused' },\nbreak: { icon: '..', label: 'ON BREAK', class: 'break' },\nwithered: { icon: 'X', label: 'PLANT WITHERED', class: 'withered' }\n};\nconst config = statusConfig[state.status] || statusConfig.idle;\nelements.statusLabel.textContent = config.label;\nelements.statusLabel.className = 'status-label ' + config.class;\nelements.currentTask.textContent = state.currentTask || 'Niciun task activ';\n// Update timer\nupdateTimerDisplay();\n// Enable/disable water button\nelements.btnWater.disabled = state.status !== 'idle' || state.plant.isWithered;\n// Only re-render tasks if status or current task changed (avoid flickering)\nif (prevStatus !== state.status || prevTask !== state.currentTask) {\nrenderTasks();\n// Refresh stats when transitioning to idle or break (session ended)\nif (state.status === 'idle' || state.status === 'break') {\nfetchWeeklyStats();\n}\n}\n}\nfunction updateTimerDisplay() {\nconst minutes = Math.floor(state.timeLeft / 60);\nconst seconds = state.timeLeft % 60;\nelements.timerValue.textContent =\n`${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;\n// Update progress bar\nif (state.totalTime > 0) {\nconst progress = ((state.totalTime - state.timeLeft) / state.totalTime) * 100;\nelements.timerBar.style.width = `${progress}%`;\n} else {\nelements.timerBar.style.width = '0%';\n}\n}\nfunction updatePlant(data) {\nif (data) {\nstate.plant.stage = data.stage !== undefined ? data.stage : state.plant.stage;\nstate.plant.isWithered = data.isWithered || false;\n// Update these from ESP32 data if available\nif (data.pendingWater !== undefined) state.pendingWater = data.pendingWater;\nif (data.wateredCount !== undefined) state.wateredCount = data.wateredCount;\nif (data.dailyGoal !== undefined) {\nstate.dailyGoal = data.dailyGoal;\nstate.goalLocked = data.dailyGoal > 0;\n}\nif (data.totalGoal !== undefined) state.currentSessionGoal = data.totalGoal;\n}\n// CalculeazÄƒ stadiul bazat pe task-uri completate vs obiectiv\nconst completedTasks = state.tasks.filter(t => t.completed).length;\nconst targetTasks = state.dailyGoal > 0 ? state.dailyGoal : state.tasks.length;\n// FoloseÈ™te stage-ul din state (care e actualizat la water)\nconst displayStage = state.plant.isWithered ? 0 : state.plant.stage;\nconst stageInfo = PLANT_STAGES[displayStage] || PLANT_STAGES[0];\n// Update plant visual\nif (state.plant.isWithered) {\nelements.plantStage.textContent = 'ðŸ¥€';\nelements.plantStage.classList.add('withered');\nelements.plantStageText.textContent = 'Ofilita';\nelements.plantHealth.innerHTML = '<span class=\"health-icon\"></span><span class=\"health-text\" style=\"color: var(--danger);\">Ofilita</span>';\n} else {\n// AfiÈ™eazÄƒ emoji-ul stadiului\nelements.plantStage.textContent = stageInfo.emoji;\nelements.plantStage.classList.remove('withered');\nelements.plantStageText.textContent = stageInfo.name;\nelements.plantHealth.innerHTML = '<span class=\"health-icon\"></span><span class=\"health-text\">Sanatoasa</span>';\n}\n// AfiÈ™eazÄƒ progresul: (task-uri udate/confirmate / task-uri noi necesare)\nconst displayGoal = state.currentSessionGoal > 0 ? state.currentSessionGoal : state.tasks.length;\nif (state.tasks.length === 0) {\nelements.stageNumber.textContent = `(0/0)`;\n} else {\nelements.stageNumber.textContent = `(${state.wateredCount}/${displayGoal})`;\n}\n// Water button: activ doar dacÄƒ existÄƒ task-uri completate care nu au fost Ã®ncÄƒ udate\n// È™i planta nu e ofilitÄƒ È™i nu suntem Ã®n focus mode\nconst canWater = state.pendingWater > 0 &&\n!state.plant.isWithered &&\nstate.status !== 'focusing' &&\nstate.plant.stage < 3;\nelements.btnWater.disabled = !canWater;\n// ActualizeazÄƒ hint-ul\nif (elements.waterHint) {\nconst totalTasks = state.tasks.length;\nconst goalSet = state.dailyGoal > 0;\nif (state.plant.stage >= 3 || (totalTasks > 0 && state.tasks.filter(t => t.completed).length >= totalTasks && state.pendingWater === 0)) {\nelements.waterHint.innerHTML = '<small>Planta a inflorit complet! Felicitari!</small>';\nelements.waterHint.className = 'water-hint complete';\n} else if (state.pendingWater > 0) {\nelements.waterHint.innerHTML = `<small>Poti uda planta! (${state.pendingWater} udari disponibile)</small>`;\nelements.waterHint.className = 'water-hint ready';\n} else if (totalTasks === 0) {\nelements.waterHint.innerHTML = '<small>Adauga task-uri pentru a incepe</small>';\nelements.waterHint.className = 'water-hint';\n} else if (!goalSet) {\nelements.waterHint.innerHTML = '<small>Seteaza obiectivul zilnic pentru a incepe</small>';\nelements.waterHint.className = 'water-hint';\n} else {\nelements.waterHint.innerHTML = '<small>Completeaza un task pentru a putea uda planta</small>';\nelements.waterHint.className = 'water-hint';\n}\n}\n// ActualizeazÄƒ afiÈ™area obiectivului\nupdateGoalDisplay();\n}\n// FuncÈ›ie pentru afiÈ™area È™i gestionarea obiectivului zilnic\nfunction updateGoalDisplay() {\nif (!elements.goalDisplay) return;\nconst completedTasks = state.tasks.filter(t => t.completed).length;\nif (state.goalLocked && state.dailyGoal > 0) {\nelements.goalDisplay.innerHTML = `\n<div class=\"goal-info\">\n<span class=\"goal-target\">Obiectiv: ${completedTasks}/${state.dailyGoal} task-uri</span>\n<button class=\"btn btn-sm btn-secondary\" id=\"btnChangeGoal\">Modifica</button>\n</div>\n`;\nelements.goalSection.classList.add('locked');\n// AdaugÄƒ event listener pentru butonul de modificare\nconst btnChange = document.getElementById('btnChangeGoal');\nif (btnChange) {\nbtnChange.onclick = resetGoal;\n}\n} else {\nelements.goalDisplay.innerHTML = '';\nelements.goalSection.classList.remove('locked');\n}\n}\n// SeteazÄƒ obiectivul zilnic\nfunction setDailyGoal() {\nconst goalValue = parseInt(elements.dailyGoalInput.value) || 0;\nconsole.log('setDailyGoal called:', { goalValue, currentDailyGoal: state.dailyGoal, goalLocked: state.goalLocked });\nif (goalValue < 1) {\nshowToast('Introdu un obiectiv valid (minim 1 task)', 'error');\nreturn;\n}\nif (goalValue > 20) {\nshowToast('Obiectivul maxim este 20 de task-uri', 'error');\nreturn;\n}\n// DacÄƒ existÄƒ un goal anterior (È™i e locked sau nu), noul goal trebuie sÄƒ fie strict mai mare\nif (state.dailyGoal > 0 && goalValue <= state.dailyGoal) {\nshowToast(`Noul obiectiv trebuie sa fie mai mare decat ${state.dailyGoal}!`, 'error');\nconsole.log('Validation failed: goalValue <= state.dailyGoal');\nreturn;\n}\n// CalculeazÄƒ cÃ¢te task-uri NOI trebuie fÄƒcute\nconst previousGoal = state.dailyGoal;\nconst newTasksNeeded = previousGoal > 0 ? (goalValue - previousGoal) : goalValue;\nstate.dailyGoal = goalValue;\nstate.currentSessionGoal = newTasksNeeded; // Task-uri noi de fÄƒcut\nstate.goalLocked = true;\n// ReseteazÄƒ planta complet pentru noul obiectiv\nstate.plant.stage = 0;\nstate.pendingWater = 0;\nstate.wateredCount = 0;  // Reset complet\n// NU recalcula pendingWater - utilizatorul trebuie sÄƒ completeze task-uri noi\nupdatePlant();\nshowToast(`Obiectiv setat: ${goalValue} task-uri! Planta a fost resetata.`, 'success');\nsendWebSocketMessage({\naction: 'setGoal',\ngoal: goalValue\n});\n}\n// ReseteazÄƒ obiectivul\nfunction resetGoal() {\nshowModal(\n'?',\n'Modifica Obiectivul',\n`Vrei sa modifici obiectivul zilnic? Noul obiectiv trebuie sa fie mai mare decat ${state.dailyGoal}. Planta va fi resetata.`,\n() => {\n// SalveazÄƒ goal-ul vechi pentru validare\nconst oldGoal = state.dailyGoal;\nstate.goalLocked = false;\n// Nu reseta dailyGoal la 0, pÄƒstreazÄƒ-l pentru validare\nif (elements.dailyGoalInput) {\n// SeteazÄƒ valoarea minimÄƒ la goal-ul curent + 1\nelements.dailyGoalInput.value = oldGoal + 1;\nelements.dailyGoalInput.min = oldGoal + 1;\n}\nupdatePlant();\nshowToast(`Seteaza un obiectiv mai mare decat ${oldGoal}!`, 'success');\n}\n);\n}\nfunction updateStats(data) {\nif (!data) return;\nstate.stats.completed = data.completed || 0;\nstate.stats.total = data.total || 0;\nstate.stats.focusMinutes = data.focusMinutes || 0;\nelements.tasksCompleted.textContent = state.stats.completed;\nelements.tasksTotal.textContent = state.stats.total;\nelements.focusTotal.textContent = state.stats.focusMinutes;\nconst percent = state.stats.total > 0\n? Math.round((state.stats.completed / state.stats.total) * 100)\n: 0;\nelements.progressPercent.textContent = `${percent}%`;\nelements.progressFill.style.width = `${percent}%`;\n}\n// ============================================\n// Task Management\n// ============================================\nfunction renderTasks() {\nconst container = elements.taskItems;\nif (state.tasks.length === 0) {\ncontainer.innerHTML = `\n<div class=\"empty-state\">\n<span class=\"empty-icon\">--</span>\n<span class=\"empty-text\">Niciun task adaugat</span>\n</div>\n`;\nelements.taskCount.textContent = '0 task-uri';\nreturn;\n}\ncontainer.innerHTML = state.tasks.map(task => {\nconst isSelected = state.selectedTaskId === task.id;\nconst isActive = task.active || (state.status === 'focusing' && state.currentTask === task.name);\n// Determine hint text based on state\nlet hintText = '';\nif (isSelected && !isActive) {\nhintText = '<div class=\"task-hint\">Flip the cube to start!</div>';\n} else if (isActive && state.status === 'focusing') {\nhintText = '<div class=\"task-hint active\">Flip back when done</div>';\n}\n// No hint for completed tasks or idle state\nreturn `\n<div class=\"task-item ${task.completed ? 'completed' : ''} ${isActive ? 'active' : ''} ${isSelected ? 'selected' : ''}\" data-id=\"${task.id}\">\n<div class=\"task-checkbox ${task.completed ? 'checked' : ''} ${!task.started ? 'disabled' : ''}\"\n${task.started ? `onclick=\"toggleTaskComplete(${task.id})\"` : `onclick=\"showToast('Trebuie sa pornesti task-ul inainte!', 'error')\"`}>\n</div>\n<div class=\"task-info\">\n<div class=\"task-name\">${escapeHtml(task.name)}</div>\n<div class=\"task-duration\">Focus: ${task.focusDuration}min / Pauza: ${task.breakDuration}min</div>\n${hintText}\n</div>\n<div class=\"task-actions\">\n${!task.completed && !isActive ? `\n${!isSelected ? `<button class=\"task-btn select\" onclick=\"selectTask(${task.id})\" title=\"Select\">&#10003;</button>` : ''}\n${isSelected ? `<button class=\"task-btn cancel\" onclick=\"cancelSelection()\" title=\"Cancel\">&#10007;</button>` : ''}\n<button class=\"task-btn delete\" onclick=\"deleteTask(${task.id})\" title=\"Delete\">&#10005;</button>\n` : ''}\n</div>\n</div>\n`}).join('');\nelements.taskCount.textContent = `${state.tasks.length} task-uri`;\nupdateStats({\ncompleted: state.tasks.filter(t => t.completed).length,\ntotal: state.tasks.length,\nfocusMinutes: state.stats.focusMinutes\n});\n}\nfunction addTask() {\nconst name = elements.taskName.value.trim();\nconst focusDuration = parseInt(elements.focusTime.value) || 25;\nconst breakDuration = parseInt(elements.breakTime.value) || 5;\nif (!name) {\nshowToast('Introdu un nume pentru task!', 'error');\nelements.taskName.focus();\nreturn;\n}\n// VerificÄƒ dacÄƒ s-a atins limita de task-uri\nif (state.goalLocked && state.tasks.length >= state.dailyGoal) {\nshowToast('Ai atins limita de task-uri pentru obiectivul zilnic!', 'error');\nreturn;\n}\nconst newTask = {\nid: Date.now(),\nname: name,\nfocusDuration: focusDuration,\nbreakDuration: breakDuration,\ncompleted: false,\nactive: false,\nstarted: false  // Flag pentru a È™ti dacÄƒ task-ul a fost pornit\n};\n// Send to ESP32\nsendWebSocketMessage({\naction: 'addTask',\ntask: newTask\n});\n// Update local state\nstate.tasks.push(newTask);\nrenderTasks();\n// ActualizeazÄƒ afiÈ™area plantei (pentru a reflecta noul total de task-uri)\nupdatePlant();\n// Clear form\nelements.taskName.value = '';\nelements.taskName.focus();\nshowToast('Task adÄƒugat!', 'success');\n}\nfunction startTask(id) {\nconst task = state.tasks.find(t => t.id === id);\nif (!task) return;\nsendWebSocketMessage({\naction: 'startTask',\ntaskId: id\n});\n// Update local state\nstate.tasks.forEach(t => t.active = false);\ntask.active = true;\ntask.started = true;  // MarcheazÄƒ ca pornit\nstate.status = 'focusing';\nstate.currentTask = task.name;\nstate.timeLeft = task.focusDuration * 60;\nstate.totalTime = task.focusDuration * 60;\nstate.selectedTaskId = 0;  // Clear selection\nupdateStatus({\nstate: 'focusing',\ntaskName: task.name,\ntimeLeft: state.timeLeft,\ntotalTime: state.totalTime\n});\nrenderTasks();\nshowToast(`Incepi: ${task.name}`, 'success');\n}\n// SelecteazÄƒ un task pentru a fi pornit cu flip MPU\nfunction selectTask(id) {\nconst task = state.tasks.find(t => t.id === id);\nif (!task) return;\nif (task.completed) {\nshowToast('Task-ul e deja completat!', 'error');\nreturn;\n}\nif (state.status === 'focusing') {\nshowToast('OpreÈ™te mai Ã®ntÃ¢i task-ul curent!', 'error');\nreturn;\n}\nsendWebSocketMessage({\naction: 'selectTask',\ntaskId: id\n});\n// Update local state\nstate.selectedTaskId = id;\ntask.started = true;\nrenderTasks();\nshowToast(`Task \"${task.name}\" selectat. ÃŽntoarce cubul pentru a Ã®ncepe!`, 'success');\n}\n// AnuleazÄƒ selecÈ›ia task-ului\nfunction cancelSelection() {\nstate.selectedTaskId = 0;\nrenderTasks();\nshowToast('SelecÈ›ie anulatÄƒ', 'info');\n}\nfunction toggleTaskComplete(id) {\nconst task = state.tasks.find(t => t.id === id);\nif (!task) return;\n// Nu poÈ›i bifa un task dacÄƒ nu a fost pornit\nif (!task.started) {\nshowToast('Trebuie sa pornesti task-ul inainte sa il completezi!', 'error');\nreturn;\n}\nconst wasCompleted = task.completed;\nconst wasActive = task.active;\ntask.completed = !task.completed;\n// CalculeazÄƒ timpul efectiv petrecut (dacÄƒ task-ul era activ)\nlet actualMinutesSpent = 0;\nif (task.completed && wasActive) {\n// Timpul petrecut = totalTime - timeLeft (Ã®n secunde), convertit Ã®n minute\nconst secondsSpent = state.totalTime - state.timeLeft;\nactualMinutesSpent = Math.ceil(secondsSpent / 60); // RotunjeÈ™te Ã®n sus\ntask.active = false;\nstate.status = 'idle';\nstate.timeLeft = 0;\nstate.totalTime = 0;\nstate.currentTask = null;\nupdateStatus({ state: 'idle', taskName: '' });\n} else if (task.completed && !wasActive) {\n// DacÄƒ task-ul nu era activ dar e completat, foloseÈ™te timpul setat\nactualMinutesSpent = task.focusDuration;\n}\nsendWebSocketMessage({\naction: 'toggleTask',\ntaskId: id,\ncompleted: task.completed\n});\n// ActualizeazÄƒ pendingWater\nif (task.completed && !wasCompleted) {\n// Task nou completat - adaugÄƒ o \"udare\" disponibilÄƒ\nstate.pendingWater++;\nstate.stats.focusMinutes += actualMinutesSpent;\nshowToast('Task completat! Poti uda planta!', 'success');\n} else if (!task.completed && wasCompleted) {\n// Task debifat - scade pendingWater dacÄƒ e posibil\nstate.pendingWater = Math.max(0, state.pendingWater - 1);\n// Scade È™i minutele (foloseÈ™te focusDuration ca estimare)\nstate.stats.focusMinutes = Math.max(0, state.stats.focusMinutes - task.focusDuration);\n}\nrenderTasks();\nupdatePlant();\n}\nfunction deleteTask(id) {\nshowModal(\n'X',\n'Sterge Task',\n'Esti sigur ca vrei sa stergi acest task?',\n() => {\nconst task = state.tasks.find(t => t.id === id);\n// DacÄƒ task-ul era activ (countdown Ã®n desfÄƒÈ™urare), reseteazÄƒ timer-ul\nif (task && task.active) {\nstate.status = 'idle';\nstate.timeLeft = 0;\nstate.totalTime = 0;\nstate.currentTask = null;\nupdateStatus({ state: 'idle', taskName: '' });\n}\n// DacÄƒ task-ul era completat, scade pendingWater\nif (task && task.completed && state.pendingWater > 0) {\nstate.pendingWater--;\n}\nstate.tasks = state.tasks.filter(t => t.id !== id);\nsendWebSocketMessage({\naction: 'deleteTask',\ntaskId: id\n});\nrenderTasks();\nupdatePlant();  // ActualizeazÄƒ afiÈ™area plantei\nshowToast('Task sters', 'success');\n}\n);\n}\n// ============================================\n// Plant Actions\n// ============================================\nfunction waterPlant() {\nif (state.plant.isWithered) {\nshowToast('Planta este ofilitÄƒ! FoloseÈ™te lumina pentru a o reÃ®nvia.', 'error');\nreturn;\n}\nif (!state.goalLocked || state.dailyGoal <= 0) {\nshowToast('SeteazÄƒ mai Ã®ntÃ¢i obiectivul zilnic!', 'error');\nreturn;\n}\nif (state.pendingWater <= 0) {\nshowToast('CompleteazÄƒ un task pentru a putea uda planta!', 'error');\nreturn;\n}\nif (state.plant.stage >= 3) {\nshowToast('Planta a crescut complet! ðŸŒ¸', 'success');\nreturn;\n}\nsendWebSocketMessage({ action: 'water' });\n// FoloseÈ™te currentSessionGoal dacÄƒ existÄƒ, altfel totalTasks\nconst goalsToComplete = state.currentSessionGoal > 0 ? state.currentSessionGoal : state.tasks.length;\n// ConsumÄƒ o \"udare\" È™i incrementeazÄƒ wateredCount\nstate.pendingWater--;\nstate.wateredCount++;\n// Stadiile sunt FIX 4: 0 (SeminÈ›Äƒ), 1 (LÄƒstar), 2 (CreÈ™tere), 3 (ÃŽnflorit)\n// Logica bazatÄƒ pe wateredCount (task-uri confirmate prin udare):\n// - 0 udate = SÄƒmÃ¢nÈ›Äƒ (0)\n// - 1 udatÄƒ = LÄƒstar (1)\n// - 2+ udate, dar NU toate = CreÈ™tere (2)\n// - TOATE udate = ÃŽnflorit (3)\nlet targetStage;\nif (state.wateredCount >= goalsToComplete) {\ntargetStage = 3; // Toate udate = ÃŽnflorit\n} else if (state.wateredCount >= 2) {\ntargetStage = 2; // 2+ dar nu toate = CreÈ™tere\n} else if (state.wateredCount >= 1) {\ntargetStage = 1; // 1 udatÄƒ = LÄƒstar\n} else {\ntargetStage = 0; // Nimic udat = SÄƒmÃ¢nÈ›Äƒ\n}\nconst oldStage = state.plant.stage;\nstate.plant.stage = targetStage;\nconst stageInfo = PLANT_STAGES[state.plant.stage];\nupdatePlant();\nif (state.plant.stage >= 3) {\nshowToast('Planta a inflorit complet! Felicitari!', 'success');\n} else if (state.plant.stage > oldStage) {\nshowToast(`Planta a crescut! Acum e ${stageInfo.name}!`, 'success');\n} else {\nshowToast(`Planta a fost udata! Mai completeaza task-uri pentru a creste!`, 'success');\n}\n// Trigger heart animation\ntriggerHeartAnimation();\n}\nfunction killPlant() {\nshowModal(\n'X',\n'Demo Mode',\n'Aceasta va omori planta pentru demonstratie. Poti sa o reinvii cu senzorul de lumina.',\n() => {\nsendWebSocketMessage({ action: 'kill' });\nstate.plant.isWithered = true;\nupdatePlant({ stage: state.plant.stage, isWithered: true });\nupdateStatus({ state: 'withered', taskName: 'Planta a murit!' });\nshowToast('Planta a fost ofilita', 'error');\n}\n);\n}\nfunction triggerHeartAnimation() {\n// Visual feedback for water animation\nconst heart = document.createElement('div');\nheart.innerHTML = '+';\nheart.style.cssText = `\nposition: fixed;\ntop: 50%;\nleft: 50%;\nfont-size: 4rem;\ncolor: var(--primary);\nfont-weight: bold;\ntransform: translate(-50%, -50%) scale(0);\nanimation: heartPop 0.6s ease forwards;\nz-index: 1000;\npointer-events: none;\n`;\ndocument.body.appendChild(heart);\nsetTimeout(() => heart.remove(), 600);\n}\nfunction showReviveAnimation() {\n// Special animation for plant revival\nconst reviveOverlay = document.createElement('div');\nreviveOverlay.style.cssText = `\nposition: fixed;\ntop: 0;\nleft: 0;\nwidth: 100%;\nheight: 100%;\nbackground: rgba(0,0,0,0.9);\ndisplay: flex;\nflex-direction: column;\nalign-items: center;\njustify-content: center;\nz-index: 2000;\nanimation: fadeIn 0.5s ease;\n`;\nreviveOverlay.innerHTML = `\n<div style=\"font-size: 6rem; animation: bounce 1s ease infinite; text-shadow: 0 0 30px rgba(46,204,113,0.8);\">ðŸŒ±</div>\n<div style=\"color: #2ecc71; font-size: 2rem; font-weight: bold; margin-top: 1.5rem; text-align: center; text-shadow: 0 2px 10px rgba(0,0,0,0.5);\">\nPlant Revived!\n</div>\n<div style=\"color: white; font-size: 1.2rem; margin-top: 0.8rem; text-align: center; padding: 0 2rem;\">\nYou can plant again and start a new journey!\n</div>\n`;\ndocument.body.appendChild(reviveOverlay);\n// Refresh plant display\nstate.plant.stage = 0;\nstate.plant.isWithered = false;\nupdatePlant();\n// Remove after 3 seconds\nsetTimeout(() => {\nreviveOverlay.style.animation = 'fadeOut 0.5s ease forwards';\nsetTimeout(() => reviveOverlay.remove(), 500);\n}, 3000);\n}\n// Add heart animation keyframes\nconst style = document.createElement('style');\nstyle.textContent = `\n@keyframes heartPop {\n0% { transform: translate(-50%, -50%) scale(0); opacity: 1; }\n50% { transform: translate(-50%, -50%) scale(1.5); opacity: 1; }\n100% { transform: translate(-50%, -50%) scale(1); opacity: 0; }\n}\n@keyframes fadeIn {\nfrom { opacity: 0; }\nto { opacity: 1; }\n}\n@keyframes fadeOut {\nfrom { opacity: 1; }\nto { opacity: 0; }\n}\n@keyframes bounce {\n0%, 100% { transform: translateY(0); }\n50% { transform: translateY(-20px); }\n}\n`;\ndocument.head.appendChild(style);\n// ============================================\n// UI Helpers\n// ============================================\nfunction showToast(message, type = 'success') {\nelements.toastIcon.textContent = type === 'success' ? '+' : '!';\nelements.toastMessage.textContent = message;\nelements.toast.className = `toast ${type} show`;\nsetTimeout(() => {\nelements.toast.classList.remove('show');\n}, 3000);\n}\nfunction showModal(icon, title, message, onConfirm) {\nelements.modalIcon.textContent = icon;\nelements.modalTitle.textContent = title;\nelements.modalMessage.textContent = message;\nelements.modalOverlay.classList.add('show');\n// Set up confirm handler\nelements.modalConfirm.onclick = () => {\nhideModal();\nif (onConfirm) onConfirm();\n};\n}\nfunction hideModal() {\nelements.modalOverlay.classList.remove('show');\nstate.showingConfirmModal = false;\n// Reset modal buttons\nelements.modalConfirm.style.display = '';\nelements.modalCancel.style.display = '';\nelements.modalConfirm.textContent = 'Confirma';\nelements.modalCancel.textContent = 'Anuleaza';\n}\n// Special modal for flip confirmation\nfunction showFlipConfirmModal() {\nstate.showingConfirmModal = true;\nstate.flipCancelledWaitingFlipBack = false;\nelements.modalIcon.textContent = '?';\nelements.modalTitle.textContent = 'Task Complete?';\nelements.modalMessage.textContent = 'Did you finish the task, or was the flip accidental?';\nelements.modalConfirm.textContent = 'Yes, I finished!';\nelements.modalCancel.textContent = 'Accidental flip';\nelements.modalConfirm.style.display = 'inline-block';\nelements.modalCancel.style.display = 'inline-block';\nelements.modalOverlay.classList.add('show');\n// Confirm = task completed\nelements.modalConfirm.onclick = () => {\nhideModal();\nsendWebSocketMessage({ action: 'confirmComplete' });\nshowToast('Congratulations! Task completed!', 'success');\nstate.selectedTaskId = 0;\nrenderTasks();\n};\n// Cancel = accidental flip, need to flip back\nelements.modalCancel.onclick = () => {\nstate.flipCancelledWaitingFlipBack = true;\nelements.modalIcon.textContent = 'â†»';\nelements.modalTitle.textContent = 'Flip back to resume';\nelements.modalMessage.textContent = 'Flip the cube face-down to continue your focus session.';\nelements.modalConfirm.style.display = 'none';\nelements.modalCancel.style.display = 'none';\nsendWebSocketMessage({ action: 'cancelComplete' });\n};\n}\nfunction escapeHtml(text) {\nconst div = document.createElement('div');\ndiv.textContent = text;\nreturn div.innerHTML;\n}\nfunction updateClock() {\nconst now = new Date();\nconst hours = String(now.getHours()).padStart(2, '0');\nconst minutes = String(now.getMinutes()).padStart(2, '0');\nelements.currentTime.textContent = `${hours}:${minutes}`;\n}\n// ============================================\n// Timer Logic (local countdown for smooth UI)\n// Only runs when WebSocket is disconnected\n// ============================================\nfunction startLocalTimer() {\nsetInterval(() => {\n// Only run local timer if WebSocket is NOT connected\n// When connected, ESP32 sends updates and we use those\nif (!state.wsConnected && state.timeLeft > 0 && (state.status === 'focusing' || state.status === 'break')) {\nstate.timeLeft--;\nupdateTimerDisplay();\nif (state.timeLeft === 0) {\nhandleTimerComplete();\n}\n}\n}, 1000);\n}\nfunction handleTimerComplete() {\nif (state.status === 'focusing') {\n// GÄƒseÈ™te task-ul activ pentru a lua durata de pauzÄƒ\nconst activeTask = state.tasks.find(t => t.active);\nconst breakDuration = activeTask ? activeTask.breakDuration : 5;\nshowToast('Focus terminat! Ia o pauza!', 'success');\n// Treci la starea de break cu countdown\nstate.status = 'break';\nstate.timeLeft = breakDuration * 60;\nstate.totalTime = breakDuration * 60;\nupdateStatus({\nstate: 'break',\ntaskName: 'Pauza',\ntimeLeft: state.timeLeft,\ntotalTime: state.totalTime\n});\n} else if (state.status === 'break') {\n// Pauza terminatÄƒ - reÃ®ncepe ciclul de focus\nconst activeTask = state.tasks.find(t => t.active);\nif (activeTask) {\n// ContinuÄƒ cu focus pentru acelaÈ™i task\nstate.status = 'focusing';\nstate.timeLeft = activeTask.focusDuration * 60;\nstate.totalTime = activeTask.focusDuration * 60;\nstate.currentTask = activeTask.name;\nupdateStatus({\nstate: 'focusing',\ntaskName: activeTask.name,\ntimeLeft: state.timeLeft,\ntotalTime: state.totalTime\n});\nshowToast('Pauza terminata! Continua cu focus!', 'success');\n} else {\n// DacÄƒ nu mai existÄƒ task activ, revino la idle\nstate.status = 'idle';\nstate.timeLeft = 0;\nstate.currentTask = null;\nupdateStatus({ state: 'idle', taskName: '' });\nrenderTasks();\n}\n}\n}\n// ============================================\n// Weekly Statistics\n// ============================================\nasync function fetchWeeklyStats() {\nif (isDevMode()) {\nupdateWeeklyStats({\nweekly: { totalTasks: 0, totalFocus: 0, avgTasksPerDay: 0, mostProductiveDayName: '-' },\ndays: []\n});\nreturn;\n}\ntry {\nconst response = await fetch(`${CONFIG.API_BASE}/api/stats`);\nconst data = await response.json();\nupdateWeeklyStats(data);\n} catch (e) {\nconsole.error('Failed to fetch weekly stats:', e);\n}\n}\nfunction updateWeeklyStats(data) {\nif (!data) return;\n// Update TODAY's stats from Analytics (accurate from ESP32)\nif (data.todayTasks !== undefined || data.todayFocus !== undefined) {\nstate.stats.completed = data.todayTasks || 0;\nstate.stats.focusMinutes = data.todayFocus || 0;\n// Update the display\nelements.tasksCompleted.textContent = state.stats.completed;\nelements.focusTotal.textContent = state.stats.focusMinutes;\n// Update progress bar based on tasks\nconst total = state.tasks.length || state.stats.total || 1;\nconst percent = Math.round((state.stats.completed / total) * 100);\nelements.progressPercent.textContent = `${percent}%`;\nelements.progressFill.style.width = `${percent}%`;\n}\nif (!data.weekly) return;\nconst weekly = data.weekly;\n// Update weekly summary numbers\nif (elements.weeklyTasks) elements.weeklyTasks.textContent = weekly.totalTasks || 0;\nif (elements.weeklyFocus) elements.weeklyFocus.textContent = weekly.totalFocus || 0;\nif (elements.weeklyAvg) elements.weeklyAvg.textContent = (weekly.avgTasksPerDay || 0).toFixed(1);\nif (elements.bestDay) elements.bestDay.textContent = weekly.mostProductiveDayName || '-';\n// Render weekly chart\nif (elements.weeklyChart && data.days) {\nrenderWeeklyChart(data.days);\n}\n}\nfunction renderWeeklyChart(days) {\nif (!elements.weeklyChart) return;\nconst dayNames = ['Dum', 'Lun', 'Mar', 'Mie', 'Joi', 'Vin', 'Sam'];\nconst today = new Date().getDay();\n// Find max value for scaling\nconst maxTasks = Math.max(...days.map(d => d.tasks || 0), 1);\nlet html = '';\nfor (let i = 6; i >= 0; i--) {\nconst dayData = days.find(d => d.daysAgo === i) || { tasks: 0, focus: 0, valid: false };\nconst height = dayData.valid ? Math.max((dayData.tasks / maxTasks) * 100, 8) : 8;\nconst dayIndex = (today - i + 7) % 7;\nconst isToday = i === 0;\nhtml += `<div class=\"chart-bar ${isToday ? 'today' : ''} ${dayData.valid ? 'has-data' : ''}\"\nstyle=\"height: ${height}%\"\ndata-day=\"${dayNames[dayIndex]}\"\nonclick=\"showDayDetails(${i}, ${dayData.tasks || 0}, ${dayData.focus || 0}, '${dayNames[dayIndex]}')\"\ntitle=\"${dayData.tasks || 0} task-uri, ${dayData.focus || 0} min focus\"></div>`;\n}\nelements.weeklyChart.innerHTML = html;\n}\nfunction showDayDetails(daysAgo, tasks, focus, dayName) {\nconst label = daysAgo === 0 ? 'Azi' : (daysAgo === 1 ? 'Ieri' : dayName);\nconst hours = Math.floor(focus / 60);\nconst mins = focus % 60;\nconst focusStr = hours > 0 ? `${hours}h ${mins}m` : `${mins} min`;\nshowToast(`${label}: ${tasks} task-uri, ${focusStr} focus`, 'success');\n}\n// ============================================\n// Sync Time from Phone\n// ============================================\nfunction syncTimeFromPhone() {\nconst now = new Date();\nconst hours = now.getHours();\nconst minutes = now.getMinutes();\nconst seconds = now.getSeconds();\nconst day = now.getDate();\nconst month = now.getMonth() + 1; // 0-indexed\nconst year = now.getFullYear();\nsendWebSocketMessage({\naction: 'setTime',\nhours: hours,\nminutes: minutes,\nseconds: seconds,\nday: day,\nmonth: month,\nyear: year\n});\nshowToast(`Ora sincronizata: ${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}`, 'success');\n}\n// ============================================\n// Reset Day\n// ============================================\nfunction resetDay() {\nshowModal(\n'âš ï¸',\n'Resetare Zi',\n'Aceasta va reseta toate task-urile si planta pentru o zi noua. Esti sigur?',\n() => {\nsendWebSocketMessage({ action: 'restartDay' });\n// Reset local state\nstate.tasks = [];\nstate.plant.stage = 0;\nstate.pendingWater = 0;\nstate.wateredCount = 0;\nstate.dailyGoal = 0;\nstate.goalLocked = false;\nstate.status = 'idle';\nstate.timeLeft = 0;\nrenderTasks();\nupdatePlant();\nupdateStatus({ state: 'idle', taskName: '' });\nshowToast('Zi resetata! Incepe o zi noua!', 'success');\n}\n);\n}\n// ============================================\n// Mock Data (pentru dezvoltare fÄƒrÄƒ ESP32)\n// ============================================\nfunction loadMockData() {\n// Start fresh - no predefined tasks\nstate.tasks = [];\nstate.plant.stage = 0;\nstate.plant.isWithered = false;\nstate.pendingWater = 0;\nstate.wateredCount = 0;\nstate.dailyGoal = 0;\nstate.currentSessionGoal = 0;\nstate.goalLocked = false;\nstate.status = 'idle';\nstate.timeLeft = 0;\nstate.totalTime = 0;\nstate.currentTask = null;\nstate.stats = {\ncompleted: 0,\ntotal: 0,\nfocusMinutes: 0\n};\n// Set default goal value in input\nif (elements.dailyGoalInput) {\nelements.dailyGoalInput.value = 3;\n}\n// DezactiveazÄƒ explicit butonul de udare\nif (elements.btnWater) {\nelements.btnWater.disabled = true;\n}\nrenderTasks();\nupdatePlant();\nupdateStats(state.stats);\nupdateStatus({ state: 'idle', taskName: null, timeLeft: 0, totalTime: 0 });\nelements.espIP.textContent = 'Dev Mode';\n}\nfunction handleMockAction(action) {\nconsole.log('Mock action:', action);\n// Simulate responses locally\nreturn { success: true };\n}\n// ============================================\n// Event Listeners\n// ============================================\nfunction initEventListeners() {\n// Add task\nelements.btnAddTask.addEventListener('click', addTask);\nelements.taskName.addEventListener('keypress', (e) => {\nif (e.key === 'Enter') addTask();\n});\n// Daily goal\nif (elements.btnSetGoal) {\nelements.btnSetGoal.addEventListener('click', setDailyGoal);\n}\nif (elements.dailyGoalInput) {\nelements.dailyGoalInput.addEventListener('keypress', (e) => {\nif (e.key === 'Enter') setDailyGoal();\n});\n}\n// Plant actions\nelements.btnWater.addEventListener('click', waterPlant);\nelements.btnKill.addEventListener('click', killPlant);\n// Sync time button\nif (elements.btnSyncTime) {\nelements.btnSyncTime.addEventListener('click', syncTimeFromPhone);\n}\n// Reset day button\nif (elements.btnResetDay) {\nelements.btnResetDay.addEventListener('click', resetDay);\n}\n// Modal - only allow closing by clicking overlay if NOT waiting for flip back\n// Note: modalCancel behavior is set dynamically in showModal/showFlipConfirmModal\nelements.modalOverlay.addEventListener('click', (e) => {\n// Only close if clicking directly on overlay AND not waiting for flip back\nif (e.target === elements.modalOverlay && !state.flipCancelledWaitingFlipBack) {\nhideModal();\n}\n});\n// Prevent zoom on double-tap (mobile)\ndocument.addEventListener('touchend', (e) => {\nconst now = Date.now();\nif (now - (window.lastTouchEnd || 0) < 300) {\ne.preventDefault();\n}\nwindow.lastTouchEnd = now;\n}, false);\n}\n// ============================================\n// Initialization\n// ============================================\nfunction init() {\nconsole.log('ðŸŒ± Productivity Bloom initializing...');\n// Initialize event listeners\ninitEventListeners();\n// Start clock update\nupdateClock();\nsetInterval(updateClock, 1000);\n// Try WebSocket first\nconnectWebSocket();\n// Start local timer (only runs when WebSocket disconnected)\nstartLocalTimer();\n// Initial data fetch - do this immediately!\nconsole.log('Fetching initial status...');\nfetchStatus();\nfetchTasks();\nfetchWeeklyStats();\n// Refresh weekly stats every 30 seconds\nsetInterval(fetchWeeklyStats, 30000);\n// API polling only when WebSocket is not connected\n// Reduces load when already getting updates via WebSocket\nsetInterval(() => {\nif (!state.wsConnected) {\nfetchStatus();\nconsole.log('Polling for status (WS disconnected)...');\n}\n}, 2000);  // Poll every 2 seconds instead of 1\nconsole.log('ðŸŒ± Productivity Bloom ready!');\n}\n// Start app when DOM is ready\nif (document.readyState === 'loading') {\ndocument.addEventListener('DOMContentLoaded', init);\n} else {\ninit();\n}</script>\n</body>\n</html>\n";

#endif
